{% extends "base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/attendance.css') }}">
{% endblock %}

{% block content %}
<div class="main-left">
    <h2>Create a new attendance code</h2>
    <form action="" method="post" novalidate>
        {{ form.hidden_tag() }}
        <p>
            {{ form.code(class_="code-input", placeholder="Attendance code", autocomplete="off", spellcheck="false") }}
        </p>
        <p>
            {{ form.date() }}
        </p>
        <p>
            {{ form.start_time() }}
            {{ form.end_time() }}
        </p>
        <p>
            {{ form.submit(class_="form-submit admin-submit") }}
        </p>
        <div class="errors">
            {% if form.code.errors %}
                {% for error in form.code.errors %}
                    <p class="form-error">{{ error }}</p>
                {% endfor %}
                <a href="">Clear</a>
            {% endif %}
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <p class="form-error">{{ message }}</p>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>
    </form>
    <div class="attendance-container">
        <h2>Attendance codes</h2>
        {% if attendances %}
            <p class="attendance-row">
                <span class="row-heading display">Display</span>
                <span class="row-heading code">Attendance Code</span>
                <span class="row-heading date">Start Date</span>
                <span class="row-heading date">End Date</span>
                <span class="row-heading attendees">Attendees</span>
                <span class="row-heading invalid">Status</span>
            </p>
            {% for attendance in attendances %}
                <p class="attendance-row">
                    <a class="display" href="{{ url_for('attendance.display', code=attendance.code) }}">
                        <i class="fa-solid fa-arrow-up-right-from-square"></i>
                    </a>
                    <span class="code">{{ attendance.code }}</span>
                    <span class="date">{{ format_time(attendance.start_time) }}</span>
                    <span class="date">{{ format_time(attendance.end_time) }}</span>
                    <a class="attendees" href="{{ url_for('attendance.attendees', code=attendance.code) }}">
                        <i class="fa-solid fa-user"></i> {{ len(attendance.attendees.all()) }}
                    </a>
                    {% if is_valid_attendance(attendance) %}
                    <span class="valid">Valid</span>
                    {% else %}
                    <span class="invalid">Expired</span>
                    {% endif %}
                </p>
            {% endfor %}
        {% else %}
            <p>No attendances recorded.</p>
        {% endif %}
    </div>
</div>
{% endblock %}